/**
 * @copyright   Copyright Â© 2024 Blue-Coder.com. All rights reserved.
 * @license     GNU General Public License 2 or later, see COPYING.txt for license details.
 */
"use strict";window.JFilters=window.JFilters||{},JFilters.range_sliders=class{static counter=0;constructor(t,e){this.options={start:0,end:1e3,listen:!0,knobHeight:20,knobWidth:20,filterId:0,moduleId:0,withInputs:!1,filterAlias:"",baseURL:"",urlFormat:"",minDelta:1};this.setOptions(e),this.container=t,this.element=t.querySelector(".jfilters-filter-range-sliders__gutter"),this.minKnob=t.querySelector(".jfilters-filter-range-sliders__knob--from"),this.maxKnob=t.querySelector(".jfilters-filter-range-sliders__knob--to"),this.bkg=t.querySelector(".jfilters-filter-range-sliders__slider_bckgr"),this.steps=parseInt(this.options.end)-parseInt(this.options.start),this.sliderWidth=this.minKnob.clientWidth,this.updateTooltip(this.minKnob),this.updateTooltip(this.maxKnob),this.fillRange(),this.init()}setOptions(t){for(const[e,i]of Object.entries(t))this.options[e]=i}init(){this.minKnob.addEventListener("input",(()=>{const t=parseInt(this.minKnob.value),e=parseInt(this.maxKnob.value);t>e-this.options.minDelta&&(this.maxKnob.value=t+this.options.minDelta,e==this.maxKnob.max&&(this.minKnob.value=parseInt(this.maxKnob.max)-this.options.minDelta)),this.updateTooltip(this.minKnob),this.updateInputs(),this.fillRange()})),this.handleMinKnobChange=this.updateModule.bind(this),this.maxKnob.removeEventListener("change",this.handleMinKnobChange),this.minKnob.addEventListener("change",this.handleMinKnobChange),this.maxKnob.addEventListener("input",(()=>{const t=parseInt(this.minKnob.value),e=parseInt(this.maxKnob.value);e<t+this.options.minDelta&&(this.minKnob.value=e-this.options.minDelta,t==this.minKnob.min&&(this.maxKnob.value=this.options.minDelta)),this.updateTooltip(this.maxKnob),this.updateInputs(),this.fillRange()})),this.handleMaxKnobChange=this.updateModule.bind(this),this.maxKnob.removeEventListener("change",this.handleMinKnobChange),this.maxKnob.addEventListener("change",this.handleMaxKnobChange)}updateModule(){this.options.listen&&"function"==typeof JFilters.range_inputs.update&&JFilters.range_inputs.update(this.options,[this.minKnob.value,this.maxKnob.value])}setMin(t){return parseInt(t)+this.options.minDelta<=parseInt(this.maxKnob.value)&&(this.minKnob.value=t,this.fillRange()),this}setMax(t){return parseInt(t)-this.options.minDelta>=parseInt(this.minKnob.value)&&(this.maxKnob.value=t,this.fillRange()),this}fillRange(){const t=parseInt(this.minKnob.value),e=parseInt(this.minKnob.min),i=parseInt(this.maxKnob.value),n=this.sliderWidth/this.steps,s=n*(t-e);this.bkg.style.marginLeft=s+"px";const o=n*(i-e);this.bkg.style.width=o-s+"px"}updateTooltip(t){if(void 0!==t.tooltipElement){t.tooltipElement.setValue(t.value),t.tooltipElement.setCharLength(t.value.length);const e=this.sliderWidth/this.steps,i=parseInt(this.minKnob.min),n=e*(parseInt(t.value)-i);t.tooltipElement.positionX(n)}}updateInputs(){if(this.options.withInputs){let t=this.container.parentNode.querySelector(".jfilters-filter-range_inputs--withSlider");if(t){const e=[].slice.call(t.querySelectorAll(".jfilters-filter-range_inputs__input"));2===e.length&&(e[0].value=this.minKnob.value,e[1].value=this.maxKnob.value)}}}},JFilters.range_sliders.boot=()=>{const t=Joomla.getOptions("jfilters.filter",{});void 0!==t&&t.forEach((t=>{if(!t.extraProperties||"range_sliders"!=t.extraProperties.type)return;let e=t.extraProperties;const i=window.JFilters.filteringModule.moduleWrapperSelectorPrefix+t.moduleId,n=document.querySelector(i);if(!n)return;let s={filterId:t.id,moduleId:t.moduleId,filterAlias:e.alias,baseUrl:e.baseUrl,urlFormat:e.urlFormat,start:e.minValue,end:e.maxValue,withInputs:e.withInputs},o=e.wrapperSelector?e.wrapperSelector:".jfilters-filter-range-sliders";[].slice.call(n.querySelectorAll(o)).forEach((t=>{t.rangeSliders||(t.rangeSliders=new JFilters.range_sliders(t,s))}))}))},document.addEventListener("DOMContentLoaded",JFilters.range_sliders.boot);
