/**
 * @package     Bluecoder.JFilters
 *
 * @copyright   Copyright Â© 2023 Blue-Coder.com. All rights reserved.
 * @license     GNU General Public License 2 or later, see COPYING.txt for license details.
 */
((e,t)=>{if(!e)throw new Error("core.js was not properly initialised");if(window.JFilters=window.JFilters||{},!e)throw new Error("core.js was not properly initialised");JFilters.subform_index=()=>{let r,o=null,s=0,n=null;const i=`&${t.getElementById("jfilters-index-token").getAttribute("name")}=1`,l=(r,i,l)=>{n=s/o*100;const a=t.getElementById("progress-bar"),d=t.getElementById("jfilters-progress-header"),m=t.getElementById("jfilters-progress-message");d&&r&&(d.innerText=r),m&&i&&(console.log(i),m.innerHTML=e.sanitizeHtml(i)),a&&(n<100?(a.style.width=`${n}%`,a.setAttribute("aria-valuenow",n)):(a.classList.remove("bar-success"),a.classList.add("bar-warning"),a.setAttribute("aria-valuemin",100),a.setAttribute("aria-valuemax",200),a.style.width=`${n}%`,a.setAttribute("aria-valuenow",n)),l&&((e=>{const r=t.getElementById(e);r&&r.parentNode.removeChild(r)})("progress"),window.parent.Joomla.Modal.getCurrent().close()))};r=n=>{e.request({url:`index.php?option=com_jfilters&view=subform&tmpl=component&format=json&task=${n}${i}`,method:"GET",data:"",perform:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},onSuccess:e=>{!function(e){try{if(null===e)throw new Error(resp);if(e.error)throw new Error(e);e.start&&(o=e.total),s=e.batchOffset,console.log("offset:",s," batch:",e.batchSize," total:",o," complete:",e.complete),l(e.header,e.msg,e.complete),s<o&&r("subform.batchIndex")}catch(e){throw new Error(e)}}(JSON.parse(e))},onError:r=>{(r=>{const o=t.getElementById("jfilters-progress-header"),s=t.getElementById("jfilters-progress-message");let n="object"==typeof r&&r.responseText?r.responseText:null;n=n?JSON.parse(n):null,o&&(o.innerText=n.header,o.classList.add("jfilters-index-error")),s&&n.error&&(s.innerHTML=e.sanitizeHtml(n.msg),s.classList.add("jfilters-index-error"))})(r)}})};r("subform.startIndexer")}})(Joomla,document),document.addEventListener("DOMContentLoaded",(()=>{window.Subform_Indexer=JFilters.subform_index()}));
